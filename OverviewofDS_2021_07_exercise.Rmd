---
title: "データ科学概観 第７回 演習"
author: "中野直人<br>京都大学国際高等教育院附属データ科学イノベーション教育研究センター"
date: "2021/6/13"
output: 
  html_document:
    code_folding: hide
    highlight: "zenburn"
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = T)
library(DT)
```

---

<h3> 氏名：＜氏名を記入すること＞</h3>
<h3> 所属研究科：＜研究科名を記入すること＞</h3>
<h3> 学年：＜学年を記入すること＞</h3>
<h3> 学生番号：＜学生番号を記入すること＞</h3>

---

# 分散分析について講義で習ったことを演習しましょう

この Rmd ファイルは穴開きになっています．必要事項を自分で記入して完成させましょう

記入毎に Ctrl + s でこまめに保存すること

Rmd ファイルの出力は上の Knit を押して確認すると良い

---

## 例題1

（参考：心理学マニュアル 要因計画法，後藤宗理，大野木裕明，中澤潤，北大路書房 2000年）

生徒の学習形態のちがいが，課題の達成に影響するかどうかを調べる．
<br>
あらかじめ学力の等しい生徒をランダムにわけて，3 つのグループを構成．

- グループ1 では一斉指導
- グループ2 では体験学習
- グループ3 では仲間による討議学習

授業終了後，課題の到達度テストを実施したところ，次の得点が得られた．
<br>
3 つの学習形態のあいだに差はあるか？

| 学習形態 | 一斉指導 | 体験学習 | 討議学習 |
|:--------:|:--------:|:--------:|:--------:|
|  | 5 | 8 | 7 |
|  | 4 | 4 | 6 |
|  | 6 | 3 | 8 |
|  | 3 | 3 | 9 |
|  | 3 | 7 | 10|
|  | 7 | 9 | 9 |
|  | 6 | 8 | 8 |
|  | 5 | 7 | 9 |
|  | 3 | 3 | 7 |
|  | 5 | 4 | 8 |

---

### 検定の設定

帰無仮説 $H_0$: グループ1, 2, 3 の平均は等しい（学習形態のあいだに差はない）

有意水準 $\alpha=0.01$ で一元配置分散分析をおこなう

---

### データ格納

まずは R でデータフレームとして格納しよう

R のコマンド実行時は ``` で囲まれた部分の右上に ▶︎ を押して実行

```{r set-groups}
# group1: G1


# group2: G2


# group3: G3


# data frame: datf


# plot


```


---

### 準備

パラメータを代入しておく
```{r set-data-param}
# 全データを格納する配列: data



# 総標本サイズ: N



# 各群の標本サイズ: n1, n2, n3



# 群の数（標本数）: m


```

---

### 平均の計算

群内平均を計算
```{r calc-mean}
# group1 の平均: mean1



# group2 の平均: mean2



# group3 の平均: mean3


```

総平均を計算
```{r calc-meanT}
# 総平均: meanT


```

---

### 平方和の計算

群内平方和と群間平方和をそれぞれ計算しよう
```{r calc-ss}
# group1 の平方和: SS1


# group2 の平方和: SS2


# group3 の平方和: SS3


# 群内平方和: SSW


# 群間平方和: SSA


```

総平方和を計算して確認
```{r calc-total-ss}
# 総平方和: SS



# SSA + SSW = SS を確認しよう


```

---

### 平均平方の計算

```{r calc-ms}
# 群内平均平方: MSW


# 群間平均平方: MSA


```

### 分散比の計算

このデータに対する $F$ 統計量は
```{r calc-fstar}
# F統計量: Fstar


```

でかいな．．．

```{r calc-F-critical}
# F(m-1, N-m) の上側1％点: F0


```

---

### 検定結果

```
ここに検定結果を書こう
```


---

### 有意確率の計算

もしくは直接 $F^*$ から確率を計算しても良い
```{r calc-pval}
# 有意確率: pval


```

```
有意確率を計算した上での検定の結果をここに書こう
```


---

### F分布の確率密度関数と比較

パラメータ準備
```{r set-plot-param}
# 横軸 Fstarから11: xF


# 縦軸 その点でのF分布の確率密度関数の値: yF


# 横軸 0 から 11: x


# 縦軸 その点でのt分布の確率密度関数の値: y


# 横軸 棄却限界から 11: xp


# 縦軸 その点でのt分布の確率密度関数の値: yp


```

#### 描画

```{r plot-F, echo=F}
# F(m-1, N-m) の確率密度関数


# 高さ 0 の横線


# 上側1%点の区切り線


# 棄却域


# 帰無仮説の下でのFstarの表れる確率


```

---

### 分散分析表を作成しよう

上で計算した値を以下に記入して分散分析表を完成させよう．

| 変動要因      | 平方和          | 自由度 $\mathrm{df}$ | 平均平方        | 分散比 $F$                    |
|:-------------:|:---------------:|:--------------------:|:---------------:|:-----------------------------:|
|群間変動(処理) | $\mathrm{SS_A}$ | $m-1$                | $\mathrm{MS_A}$ | $\mathrm{MS_A}/\mathrm{MS_W}$ |
|群内変動(誤差) | $\mathrm{SS_W}$ | $N-m$                | $\mathrm{MS_W}$ |                               |
|全体           | $\mathrm{SS}$   | $N-1$                | $\mathrm{MS_T}$ |                               |

---

## Rのコマンドを使おう

上のように分散分析の手続きに沿って計算する代わりに R に一発で分散分析を計算させることもできる．

各群を表すラベルを作る
```{r set-group-label}
# 群を表すラベル配列: group


# groupをカテゴリカル変数に変更


```

R の aov コマンドで一発
```{r perform-aov}
# aovコマンド


```


この結果と自分で計算した内容が一致しただろうか．表示桁数の違いよりも大きく結果が異なる場合は自分の計算がどこか間違っている．間違いを探し，なくすこと．

---

## 多重比較法

どの群の間に有意差があるか？を調べるのが多重比較法である．
色々な手法があるが，ここでは Tukey の HSD 検定 (Honestly Signiicant Difference test) を用いよう．
これは群間全ての対比較を同時におこなう．標本サイズが全ての群を通じて等しくないといけない．（群によって標本サイズが異なる場合は Tukey--Kramer の方法を用いればよい．

```{r groups-boxplot}
# 各群の箱ひげ図


```

Tukey の HSD 検定も R のコマンドを用いれば簡単だ
```{r perform-tukey-hsd}
# Tukey HSD


```

```{r identify-significant}
# 有意に差がある群のペアを表示


```

```
ここにTukeyのHSDの結果を書こう
```


---

<div style="text-align: right">**以上**</div>
